/*!!
 * author  : FeiNiu WuHan UED (HQY)
 * version : 2.3.1
 * date    : 2015-11-24
 * email   : hqy321@gmail.com
 */
!function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){n(31),n(32),n(35),n(36),n(37),n(38),n(39)},function(e,t,n){function o(){}function i(e,t,n){var o=!0;if(e){var i=0,r=e.length,a=t[0],c=t[1],l=t[2];switch(t.length){case 0:for(;r>i;i+=2)o=e[i].call(e[i+1]||n)!==!1&&o;break;case 1:for(;r>i;i+=2)o=e[i].call(e[i+1]||n,a)!==!1&&o;break;case 2:for(;r>i;i+=2)o=e[i].call(e[i+1]||n,a,c)!==!1&&o;break;case 3:for(;r>i;i+=2)o=e[i].call(e[i+1]||n,a,c,l)!==!1&&o;break;default:for(;r>i;i+=2)o=e[i].apply(e[i+1]||n,t)!==!1&&o}}return o}var r=n(2),a=/\s+/;n(3).register("events/events",o),o.prototype.on=function(e,t,n){var o,i,r;if(!t)return this;for(o=this.__events||(this.__events={}),e=e.split(a);i=e.shift();)r=o[i]||(o[i]=[]),r.push(t,n);return this},o.prototype.once=function(e,t,n){var o=this,i=function(){o.off(e,i),t.apply(n||o,arguments)};return this.on(e,i,n)},o.prototype.off=function(e,t,n){var o,i,r,l;if(!(o=this.__events))return this;if(!(e||t||n))return delete this.__events,this;for(e=e?e.split(a):c(o);i=e.shift();)if(r=o[i])if(t||n)for(l=r.length-2;l>=0;l-=2)t&&r[l]!==t||n&&r[l+1]!==n||r.splice(l,2);else delete o[i];return this},o.prototype.trigger=function(e){var t,n,o,r,c,l,s=[],p=!0;if(!(t=this.__events))return this;for(e=e.split(a),c=1,l=arguments.length;l>c;c++)s[c-1]=arguments[c];for(;n=e.shift();)(o=t.all)&&(o=o.slice()),(r=t[n])&&(r=r.slice()),"all"!==n&&(p=i(r,s,this)&&p),p=i(o,[n].concat(s),this)&&p;return p};var c=r.keys,l=r.isFunction,s=function(e,t){for(var n=0;n<e.length;n++)t(e[n])};o.mixTo=function(e){function t(t){e[t]=function(){return n[t].apply(r,Array.prototype.slice.call(arguments)),this}}var n=o.prototype;if(l(e)){for(var i in n)n.hasOwnProperty(i)&&(e.prototype[i]=n[i]);s(c(n),function(t){e.prototype[t]=n[t]})}else{var r=new o;for(var i in n)n.hasOwnProperty(i)&&t(i)}},e.exports=o},function(e,t){function n(e){return null!=e&&e==e.window}function o(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var i,r=Object.prototype.toString,a=Object.prototype.hasOwnProperty;!function(){function e(){this.x=1}var t=[];e.prototype={valueOf:1,y:1};for(var n in new e)t.push(n);i="x"!==t[0]}(),t.toString=r,t.isArray=Array.isArray||function(e){return"[object Array]"===r.call(e)},t.isString=function(e){return"[object String]"===r.call(e)},t.isFunction=function(e){return"[object Function]"===r.call(e)},t.isEmptyObject=function(e){if(!e||"[object Object]"!==r.call(e)||e.nodeType||n(e)||!e.hasOwnProperty)return!1;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},t.isPlainObject=function(e){if(!e||"[object Object]"!==r.call(e)||e.nodeType||n(e))return!1;try{if(e.constructor&&!a.call(e,"constructor")&&!a.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var o;if(i)for(o in e)return a.call(e,o);for(o in e);return void 0===o||a.call(e,o)},t.uuid=function(e){var t=""+o()+o()+o()+o()+o()+o()+o()+o();return e?e+t:t},t.ucfirst=function(e){return e?e.charAt(0).toUpperCase()+e.substring(1):e},t.indexOf=Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var n=0,o=e.length;o>n;n++)if(e[n]===t)return n;return-1},t.keys=Object.keys?Object.keys:function(e){var t=[];if(!e)return t;for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}},function(e,t){var n=window.FNX=window.FNX||{},o=n.__cls=n.__cls||{};t.register=n.register=n.register||function(e,t){o[e]=t},t.include=n.include=n.include||function(e){return o[e]}},function(e,t,n){function o(e){return this instanceof o||!u(e)?void 0:r(e)}function i(e){var t,n;for(t in e)n=e[t],o.Mutators.hasOwnProperty(t)?o.Mutators[t].call(this,n):this.prototype[t]=n}function r(e){return e.extend=o.extend,e.implement=i,e}function a(){}function c(e,t,n){for(var o in t)if(t.hasOwnProperty(o)){if(n&&-1===f(n,o))continue;"prototype"!==o&&(e[o]=t[o])}}var l=n(2);e.exports=o,n(3).register("class/class",o),o.create=function(e,t){function n(){e.apply(this,arguments),this.constructor===n&&this.initialize&&this.initialize.apply(this,arguments)}return u(e)||(t=e,e=null),t||(t={}),e||(e=t.Extends||o),t.Extends=e,e!==o&&c(n,e,e.StaticsWhiteList),i.call(n,t),r(n)},o.extend=function(e){return e||(e={}),e.Extends=this,o.create(e)},o.Mutators={Extends:function(e){var t=this.prototype,n=s(e.prototype);c(n,t),n.constructor=this,this.prototype=n,this.superclass=e.prototype},Implements:function(e){p(e)||(e=[e]);for(var t,n=this.prototype;t=e.shift();)c(n,t.prototype||t)},Statics:function(e){c(this,e)}};var s=Object.__proto__?function(e){return{__proto__:e}}:function(e){return a.prototype=e,new a},p=l.isArray,u=l.isFunction,f=l.indexOf},function(e,t,n){function o(e,t){for(var n in t)if(t.hasOwnProperty(n)){var o="_onChange"+l(n);e[o]&&e.on("change:"+n,e[o])}}var i=n(4),r=n(1),a=n(6),c=n(7);Lang=n(2),e.exports=i.create({Implements:[r,a,c],initialize:function(e){this.initAttrs(e),o(this,this.attrs)},destroy:function(){this.off();for(var e in this)this.hasOwnProperty(e)&&delete this[e];this.destroy=function(){}}}),n(3).register("base/base",e.exports);var l=Lang.ucfirst},function(e,t,n){function o(e,t,n,o){for(var c,l,s=t.split(a);c=s.shift();)l=i(this,c),l.__isAspected||r.call(this,c),this.on(e+":"+c,n,o);return this}function i(e,t){var n=e[t];if(!n)throw new Error("Invalid method name: "+t);return n}function r(e){var t=this[e];this[e]=function(){var n=Array.prototype.slice.call(arguments),o=["before:"+e].concat(n);if(this.trigger.apply(this,o)!==!1){var i=t.apply(this,arguments),r=["after:"+e,i].concat(n);return this.trigger.apply(this,r),i}},this[e].__isAspected=!0}t.before=function(e,t,n){return o.call(this,"before",e,t,n)},t.after=function(e,t,n){return o.call(this,"after",e,t,n)},n(3).register("base/aspect",e.exports);var a=/\s+/},function(e,t,n){function o(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=i(t[n],e[n]));return e}function i(e,t){return y(e)?e=e.slice():b(e)&&(b(t)||(t={}),e=o(t,e)),e}function r(e,t,n){for(var o=[],i=t.constructor.prototype;i;)i.hasOwnProperty("attrs")||(i.attrs={}),c(n,i.attrs,i),w(i.attrs)||o.unshift(i.attrs),i=i.constructor.superclass;for(var r=0,a=o.length;a>r;r++)f(e,u(o[r]))}function a(e,t){f(e,u(t,!0),!0)}function c(e,t,n,o){for(var i=0,r=e.length;r>i;i++){var a=e[i];n.hasOwnProperty(a)&&(t[a]=o?t.get(a):n[a])}}function l(e,t){for(var n in t)if(t.hasOwnProperty(n)){var o,i=t[n].value;E(i)&&(o=n.match(B))&&(e[o[1]](s(o[2]),i),delete t[n])}}function s(e){var t=e.match(k),n=t[1]?"change:":"";return n+=t[2].toLowerCase()+t[3]}function p(e,t,n){var o={silent:!0};e.__initializingAttrs=!0;for(var i in n)n.hasOwnProperty(i)&&t[i].setter&&e.set(i,n[i],o);delete e.__initializingAttrs}function u(e,t){var n={};for(var o in e){var i=e[o];!t&&b(i)&&d(i,O)?n[o]=i:n[o]={value:i}}return n}function f(e,t,n){var o,r,a;for(o in t)if(t.hasOwnProperty(o)){if(r=t[o],a=e[o],a||(a=e[o]={}),void 0!==r.value&&(a.value=i(r.value,a.value)),n)continue;for(var c in _){var l=_[c];void 0!==r[l]&&(a[l]=r[l])}}return e}function d(e,t){for(var n=0,o=t.length;o>n;n++)if(e.hasOwnProperty(t[n]))return!0;return!1}function x(e){return null==e||(h(e)||y(e))&&0===e.length||w(e)}function g(e,t){if(e===t)return!0;if(x(e)&&x(t))return!0;var n=m.call(e);if(n!=m.call(t))return!1;switch(n){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase;case"[object Array]":var o=e.toString(),i=t.toString();return-1===o.indexOf("[object")&&-1===i.indexOf("[object")&&o===i}if("object"!=typeof e||"object"!=typeof t)return!1;if(b(e)&&b(t)){if(!g(q(e),q(t)))return!1;for(var r in e)if(e[r]!==t[r])return!1;return!0}return!1}var v=n(2);t.initAttrs=function(e){var t=this.attrs={},n=this.propsInAttrs||[];r(t,this,n),e&&a(t,e),p(this,t,e),l(this,t),c(n,this,t,!0)},t.get=function(e){var t=this.attrs[e]||{},n=t.value;return t.getter?t.getter.call(this,n,e):n},t.set=function(e,t,n){var i={};h(e)?i[e]=t:(i=e,n=t),n||(n={});var r=n.silent,a=n.override,c=this.attrs,l=this.__changedAttrs||(this.__changedAttrs={});for(e in i)if(i.hasOwnProperty(e)){var s=c[e]||(c[e]={});if(t=i[e],s.readOnly)throw new Error("This attribute is readOnly: "+e);s.setter&&(t=s.setter.call(this,t,e));var p=this.get(e);!a&&b(p)&&b(t)&&(t=o(o({},p),t)),c[e].value=t,this.__initializingAttrs||g(p,t)||(r?l[e]=[t,p]:this.trigger("change:"+e,t,p,e))}return this},t.change=function(){var e=this.__changedAttrs;if(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];this.trigger("change:"+t,n[0],n[1],t)}delete this.__changedAttrs}return this},n(3).register("base/attrs",e.exports);var m=v.toString,h=v.isString,y=v.isArray,E=v.isFunction,w=v.isEmptyObject,b=v.isPlainObject,q=v.keys;t._isPlainObject=b;var B=/^(on|before|after)([A-Z].*)$/,k=/^(Change)?([A-Z])(.*)/,O=["value","getter","setter","readOnly"],_=["setter","getter","readOnly"]},function(e,t,n){function o(e){return a.include(e)}function i(e,n){if(!t.isAutoRendered(n)){var o={renderType:"auto"},i=n.attr("widget-role");o[i?i:"element"]=n,r.extend(o,t.parseDataApiAttrs(r(n)));var a=e.autoRender&&e.autoRender(o);n.attr(c,!0),a&&a.cid&&n.attr(l,a.cid)}}var r=n(9),a=n(3),c="data-widget-auto-rendered",l="data-widget-rendered-element-cid";t.autoRender=function(e){return new this(e).render()},t.autoRenderAll=function(e,n){"function"==typeof e&&(n=e,e=null),e=r(e||"body"),e.find("[data-widget]").each(function(e,n){if(!t.isDataApiOff(n)){var a=n.getAttribute("data-widget")||"";i(o(a),r(n))}}),n&&n()},t.resolveRenderedElmentCid=function(e){var t,n=r(e).eq(0);return n&&(t=n.attr(l)),t},t.isAutoRendered=function(e){return r(e).attr(c)?!0:!1},t.parseDataApiAttrs=function(e){var t=r.trim(r(e).attr("widget-options")),n={};return t&&("{"!=t.substring(0,1)&&(t="{"+t+"}"),n=new Function("return "+t)()),n};var s="off"===r("body").attr("data-api");t.isDataApiOff=function(e){var t=r(e).attr("data-api");return"off"===t||"on"!==t&&s}},function(e,t){e.exports=window.jQuery||window.Zepto},function(e,t,n){function o(e){return null==e||void 0===e}function i(e){for(var t=e.length-1;t>=0&&void 0===e[t];t--)e.pop();return e}function r(e,t){var n=e.match(y),o=n[1]+u+t.cid,i=n[2]||void 0;return{type:o,selector:i}}function a(e){return E(document.documentElement,e)}var c=n(9),l=n(5),s=n(2),p=n(8),u=".delegate-events-",f="data-widget-cid",d="_onRender",x={},g=l.extend({propsInAttrs:["element","events"],element:null,events:null,attrs:{id:null,className:null,style:null,locale:"zh-cn",template:"<div></div>",model:null,parentNode:"body"},initialize:function(e){this.cid=s.uuid("widget-");var e=this.__parseDataAttrsConfig(e);g.superclass.initialize.call(this,e),this.initProps(),this.parseElement(),this.delegateEvents(),this.setup(),this.__stamp(),this.__isTemplate=!(e&&e.element)},initProps:function(){},__parseDataAttrsConfig:function(e){return e&&e.element?c.extend({},p.parseDataApiAttrs(e.element),e):e},parseElement:function(){var e=this.element;if(e?this.element=c(e):this.get("template")&&this.parseElementFromTemplate(),!this.element||!this.element[0])throw new Error("element is invalid")},parseElementFromTemplate:function(){this.element=c(this.get("template"))},delegateEvents:function(e,t,n){var o=i(Array.prototype.slice.call(arguments));if(0===o.length?(t=m(this.events)?this.events():this.events,e=this.element):1===o.length?(t=e,e=this.element):2===o.length?(n=t,t=e,e=this.element):(e||(e=this.element),this.__delegateElements||(this.__delegateElements=[]),this.__delegateElements.push(c(e))),v(t)&&m(n)){var a={};a[t]=n,t=a}for(var l in t)if(t.hasOwnProperty(l)){var s=r(l,this),p=s.type,u=s.selector;!function(t,n){var o=function(e){m(t)?t.call(n,e):n[t](e)};u?c(e).on(p,u,o):c(e).on(p,o)}(t[l],this)}return this},undelegateEvents:function(e,t){var n=i(Array.prototype.slice.call(arguments));if(t||(t=e,e=null),0===n.length){var o=u+this.cid,a=this.__delegateElements;if(this.element&&this.element.off(o),a)for(var l in a)a.hasOwnProperty(l)&&a[l].off(o)}else{var s=r(t,this);e?c(e).off(s.type,s.selector):this.element&&this.element.off(s.type,s.selector)}return this},setup:function(){},render:function(){this.rendered||(this._renderAndBindAttrs(),this.rendered=!0);var e=this.get("parentNode");return e&&!a(this.element[0])&&this.element.appendTo(e),this},_renderAndBindAttrs:function(){var e=this,t=e.attrs;for(var n in t)if(t.hasOwnProperty(n)){var i=d+h(n);if(this[i]){var r=this.get(n);o(r)||this[i](r,void 0,n),function(t){e.on("change:"+n,function(n,o,i){e[t](n,o,i)})}(i)}}},_onRenderId:function(e){this.element.attr("id",e)},_onRenderClassName:function(e){this.element.addClass(e)},_onRenderStyle:function(e){this.element.css(e)},__stamp:function(){var e=this.cid;this.element.attr(f,e),x[e]=this},$:function(e){return this.element.find(e)},destroy:function(){this.undelegateEvents(),delete x[this.cid],this.element&&this.__isTemplate&&(this.element.off(),this.element.remove()),this.element=null,g.superclass.destroy.call(this)}});c(window).unload(function(){for(var e in x)x[e].destroy()}),g.query=function(e){var t=c(e).eq(0),n=p.resolveRenderedElmentCid(t);return n||t&&(n=t.attr(f)),x[n]},g.autoRender=p.autoRender,g.autoRenderAll=p.autoRenderAll,g.StaticsWhiteList=["autoRender"],e.exports=g,n(3).register("widget/widget",g);var v=s.isString,m=s.isFunction,h=s.ucfirst,y=/^(\S+)\s*(.*)$/,E=c.contains||function(e,t){return!!(16&e.compareDocumentPosition(t))}},function(e,t,n){var o=n(12);e.exports={parseElementFromTemplate:function(){var e,t=this.get("template");/^#/.test(t)&&(e=document.getElementById(t.substring(1)))&&(t=e.innerHTML,this.set("template",t)),this.element=$(this.compile())},compile:function(e,t){e||(e=this.get("template")),t||(t=this.get("model"))||(t={}),t.toJSON&&(t=t.toJSON());var n=o.compile(e)(t);return n}},n(3).register("templatable/templatable",e.exports)},function(e,t){function n(e){return e.replace(w,"").replace(b,",").replace(q,"").replace(B,"").replace(k,"").split(O)}function o(e){return"'"+e.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}function i(e,t){function i(e){return f+=e.split(/\n/).length-1,p&&(e=e.replace(/\s+/g," ").replace(/<!--[\w\W]*?-->/g,"")),e&&(e=m[1]+o(e)+m[2]+"\n"),e}function r(e){var o=f;if(s?e=s(e,t):a&&(e=e.replace(/\n/g,function(){return f++,"$line="+f+";"})),0===e.indexOf("=")){var i=u&&!/^=[=#]/.test(e);if(e=e.replace(/^=[=#]?|[\s;]*$/g,""),i){var r=e.replace(/\s*\([^\)]+\)/,"");g[r]||/^(include|print)$/.test(r)||(e="$escape("+e+")")}else e="$string("+e+")";e=m[1]+e+m[2]}return a&&(e="$line="+o+";"+e),y(n(e),function(e){if(e&&!d[e]){var t;t="print"===e?E:"include"===e?w:g[e]?"$utils."+e:v[e]?"$helpers."+e:"$data."+e,b+=e+"="+t+",",d[e]=!0}}),e+"\n"}var a=t.debug,c=t.openTag,l=t.closeTag,s=t.parser,p=t.compress,u=t.escape,f=1,d={$data:1,$filename:1,$utils:1,$helpers:1,$out:1,$line:1},x="".trim,m=x?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],h=x?"$out+=text;return $out;":"$out.push(text);",E="function(){var text=''.concat.apply('',arguments);"+h+"}",w="function(filename,data){data=data||$data;var text=$utils.$include(filename,data,$filename);"+h+"}",b="'use strict';var $utils=this,$helpers=$utils.$helpers,"+(a?"$line=0,":""),q=m[0],B="return new String("+m[3]+");";y(e.split(c),function(e){e=e.split(l);var t=e[0],n=e[1];1===e.length?q+=i(t):(q+=r(t),n&&(q+=i(n)))});var k=b+q+B;a&&(k="try{"+k+"}catch(e){throw {filename:$filename,name:'Render Error',message:e.message,line:$line,source:"+o(e)+".split(/\\n/)[$line-1].replace(/^\\s+/,'')};}");try{var O=new Function("$data","$filename",k);return O.prototype=g,O}catch(_){throw _.temp="function anonymous($data,$filename) {"+k+"}",_}}var r=function(e,t){return"string"==typeof t?h(t,{filename:e}):l(e,t)};r.version="3.0.0",r.config=function(e,t){a[e]=t};var a=r.defaults={openTag:"<%",closeTag:"%>",escape:!0,cache:!0,compress:!1,parser:null},c=r.cache={};r.render=function(e,t){return h(e,t)};var l=r.renderFile=function(e,t){var n=r.get(e)||m({filename:e,name:"Render Error",message:"Template not found"});return t?n(t):n};r.get=function(e){var t;if(c[e])t=c[e];else if("object"==typeof document){var n=document.getElementById(e);if(n){var o=(n.value||n.innerHTML).replace(/^\s*|\s*$/g,"");t=h(o,{filename:e})}}return t};var s=function(e,t){return"string"!=typeof e&&(t=typeof e,"number"===t?e+="":e="function"===t?s(e.call(e)):""),e},p={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},u=function(e){return p[e]},f=function(e){return s(e).replace(/&(?![\w#]+;)|[<>"']/g,u)},d=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},x=function(e,t){var n,o;if(d(e))for(n=0,o=e.length;o>n;n++)t.call(e,e[n],n,e);else for(n in e)t.call(e,e[n],n)},g=r.utils={$helpers:{},$include:l,$string:s,$escape:f,$each:x};r.helper=function(e,t){v[e]=t};var v=r.helpers=g.$helpers;r.onerror=function(e){var t="Template Error\n\n";for(var n in e)t+="<"+n+">\n"+e[n]+"\n\n";"object"==typeof console&&console.error(t)};var m=function(e){return r.onerror(e),function(){return"{Template Error}"}},h=r.compile=function(e,t){function n(n){try{return new l(n,r)+""}catch(o){return t.debug?m(o)():(t.debug=!0,h(e,t)(n))}}t=t||{};for(var o in a)void 0===t[o]&&(t[o]=a[o]);var r=t.filename;try{var l=i(e,t)}catch(s){return s.filename=r||"anonymous",s.name="Syntax Error",m(s)}return n.prototype=l.prototype,n.toString=function(){return l.toString()},r&&t.cache&&(c[r]=n),n},y=g.$each,E="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",w=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,b=/[^\w$]+/g,q=new RegExp(["\\b"+E.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),B=/^\d[^,]*|,\d[^,]*/g,k=/^,+|,+$/g,O=/^$|,+/;e.exports=r},function(e,t,n){function o(e){e=l(e)||{},e.nodeType&&(e={element:e});var t=l(e.element)||u;if(1!==t.nodeType)throw new Error("posObject.element is invalid.");var n={element:t,x:e.x||0,y:e.y||0},o=t===u||"VIEWPORT"===t._id;return n.offset=function(){return d?{left:0,top:0}:o?{left:f(document).scrollLeft(),top:f(document).scrollTop()}:s(f(t)[0])},n.size=function(){var e=f(o?window:t);return{width:e.outerWidth(),height:e.outerHeight()}},n}function i(e){e.x=r(e.x,e,"width"),e.y=r(e.y,e,"height")}function r(e,t,n){if(e+="",e=e.replace(/px/gi,""),/\D/.test(e)&&(e=e.replace(/(?:top|left)/gi,"0%").replace(/center/gi,"50%").replace(/(?:bottom|right)/gi,"100%")),-1!==e.indexOf("%")&&(e=e.replace(/(\d+(?:\.\d+)?)%/gi,function(e,o){return t.size()[n]*(o/100)})),/[+\-*\/]/.test(e))try{e=new Function("return "+e)()}catch(o){throw new Error("Invalid position value: "+e)}return c(e)}function a(e){var t=e.offsetParent();t[0]===document.documentElement&&(t=f(document.body)),g&&t.css("zoom",1);var n;return n=t[0]===document.body&&"static"===t.css("position")?{top:0,left:0}:s(t[0]),n.top+=c(t.css("border-top-width")),n.left+=c(t.css("border-left-width")),n}function c(e){return parseFloat(e,10)||0}function l(e){return f(e)[0]}function s(e){var t=e.getBoundingClientRect(),n=document.documentElement;return{left:t.left+(window.pageXOffset||n.scrollLeft)-(n.clientLeft||document.body.clientLeft||0),top:t.top+(window.pageYOffset||n.scrollTop)-(n.clientTop||document.body.clientTop||0)}}var p=t,u={_id:"VIEWPORT",nodeType:1},f=n(9),d=!1,x=(window.navigator.userAgent||"").toLowerCase(),g=-1!==x.indexOf("msie 6");n(3).register("position/position",p),p.pin=function(e,t){if(e=o(e),t=o(t),e.element!==u&&"VIEWPORT"!==e.element._id){var n=f(e.element);"fixed"!==n.css("position")||g?(n.css("position","absolute"),d=!1):d=!0,i(e),i(t);var r=a(n),c=t.offset(),l=c.top+t.y-e.y-r.top,s=c.left+t.x-e.x-r.left;n.css({left:s,top:l})}},p.center=function(e,t){p.pin({element:e,x:"50%",y:"50%"},{element:t,x:"50%",y:"50%"})},p.VIEWPORT=u},,,,,,,,,,,,,,,,,,function(e,t,n){var o=n(1);describe("Events",function(){it("on and trigger",function(){var e=new o,t=sinon.spy();e.on("event",t),e.trigger("event",1,2),expect(t.callCount).toBe(1),e.trigger("event"),e.trigger("event"),e.trigger("event"),e.trigger("event"),expect(t.callCount).toBe(5)}),it("binding and triggering multiple events",function(){var e=new o,t=sinon.spy();e.on("a b c",t),e.trigger("a"),expect(t.callCount).toBe(1),e.trigger("a b"),expect(t.callCount).toBe(3),e.trigger("c"),expect(t.callCount).toBe(4),e.off("a c"),e.trigger("a b c"),expect(t.callCount).toBe(5)}),it("trigger all for each event",function(){var e=new o,t=sinon.spy(),n=sinon.spy();e.on("all",t),e.on("c",n),e.trigger("a b"),expect(t.callCount).toBe(2),expect(t.calledWith("a")),expect(t.calledWith("b")),t.reset(),e.trigger("c"),expect(t.callCount).toBe(1),expect(n.callCount).toBe(1),expect(n.calledBefore(t))}),it("on, then unbind all functions",function(){var e=new o,t=sinon.spy();e.on("event",t),e.trigger("event"),expect(t.callCount).toBe(1),e.off("event"),e.trigger("event"),expect(t.callCount).toBe(1)}),it("bind two callbacks, unbind only one",function(){var e=new o,t=sinon.spy(),n=sinon.spy();e.on("event",t),e.on("event",n),e.trigger("event"),expect(t.callCount).toBe(1),expect(n.callCount).toBe(1),e.off("event",t),e.trigger("event"),expect(t.callCount).toBe(1),expect(n.callCount).toBe(2)}),it("unbind a callback in the midst of it firing",function(){function e(){n(),t.off("event",e)}var t=new o,n=sinon.spy();t.on("event",e),t.trigger("event"),t.trigger("event"),t.trigger("event"),expect(n.callCount).toBe(1)}),it("two binds that unbind themselves",function(){function e(){i(),n.off("event",e)}function t(){r(),n.off("event",t)}var n=new o,i=sinon.spy(),r=sinon.spy();n.on("event",e),n.on("event",t),n.trigger("event"),n.trigger("event"),n.trigger("event"),expect(i.callCount).toBe(1),expect(r.callCount).toBe(1)}),it("bind a callback with a supplied context",function(){var e=new o,t={},n=sinon.spy();e.on("event",n,t),e.trigger("event"),expect(n.calledOn(t)).toBe(!0)}),it("nested trigger with unbind",function(){function e(){n(),t.off("event",e),t.trigger("event")}var t=new o,n=sinon.spy(),i=sinon.spy();t.on("event",e),t.on("event",i),t.trigger("event"),expect(n.callCount).toBe(1),expect(i.callCount).toBe(2)}),it("callback list is not altered during trigger",function(){var e=new o,t=sinon.spy();e.on("event",function(){e.on("event",t).on("all",t)}).trigger("event"),expect(t.callCount).toEqual(0),e.off().on("event",function(){e.off("event",t).off("all",t)}).on("event",t).on("all",t).trigger("event"),expect(t.callCount).toEqual(2)}),it('`o.trigger("x y")` is equal to `o.trigger("x").trigger("y")`',function(){var e=new o,t=sinon.spy();e.on("x",function(){e.on("y",t)}),e.trigger("x y"),expect(t.callCount).toBe(1),t.reset(),e.off(),e.on("x",function(){e.on("y",t)}),e.trigger("y x"),expect(t.callCount).toBe(0)}),it("`all` callback list is retrieved after each event",function(){var e=new o,t=sinon.spy();e.on("x",function(){e.on("y",t).on("all",t)}).trigger("x y"),expect(t.callCount).toBe(2)}),it("if no callback is provided, `on` is a noop",function(){expect(function(){(new o).on("test").trigger("test")}).not.toThrow()}),it("remove all events for a specific context",function(){var e=new o,t=sinon.spy(),n=sinon.spy();e.on("x y all",t),e.on("x y all",n,e),e.off(null,null,e),e.trigger("x y"),expect(t.callCount).toBe(4),expect(n.callCount).toBe(0)}),it("remove all events for a specific callback",function(){var e=new o,t=sinon.spy(),n=sinon.spy();e.on("x y all",t),e.on("x y all",n),e.off(null,n),e.trigger("x y"),expect(t.callCount).toEqual(4),expect(n.callCount).toEqual(0)}),it("off is chainable",function(){var e=new o;expect(e.off()).toEqual(e),e.on("event",function(){},e),expect(e.off()).toEqual(e),e.on("event",function(){},e),expect(e.off("event")).toEqual(e)}),xit("no DontEnums bug",function(){var e=new o,t=0;e.on("toString",function(){t++}),e.on("valueOf",function(){t++}),e.trigger("toString"),e.trigger("valueOf"),expect(t).toEqual(2)}),xit("hasOwnProperty is ok",function(){var e=new o,t=0;e.on("hasOwnProperty",function(){t++}),e.trigger("hasOwnProperty"),expect(t).toEqual(1)}),it("mixTo object instance",function(){var e={};o.mixTo(e);var t=sinon.spy();e.on("x y",t).off("x").trigger("x y"),expect(t.callCount).toEqual(1)}),it("mixTo Class function",function(){function e(){this.counter=0}o.mixTo(e);var t=new e,n=sinon.spy();t.on("x y",n).off("x").trigger("x y"),expect(n.callCount).toEqual(1)}),it("mixTo object instance which has __event property",function(){var e={__events:!0};o.mixTo(e);var t=sinon.spy();e.on("x y",t).off("x").trigger("x y"),expect(t.callCount).toEqual(1)}),it("splice bug for `off`",function(){var e=sinon.spy(),t=sinon.spy(),n=new o;n.on("event",e),n.on("event",e),n.on("event",t),n.trigger("event"),expect(e.callCount).toBe(2),expect(t.callCount).toBe(1),n.off(null,e),n.off(null,t),n.trigger("event"),expect(e.callCount).toBe(2),expect(t.callCount).toBe(1)}),it("trigger returns callback status",function(){var e=new o,t=sinon.stub(),n=sinon.stub(),i=sinon.stub();e.on("a",t),e.on("a",n),e.on("all",i),t.returns(!1),n.returns(!0),i.returns(""),expect(e.trigger("a")).toBe(!1),t.returns(void 0),n.returns(null),i.returns(""),expect(e.trigger("a")).not.toBe(!1),t.returns(!0),n.returns(!0),i.returns(!1),expect(e.trigger("a")).toBe(!1)}),xit("ignore exception in callback list",function(){var e=new o,t=new Error,n=sinon.spy(),i=sinon.spy(),r=sinon.stub();if(window.console&&console.error&&"[object Function]"===Object.prototype.toString.call(console.error))var a=sinon.spy(console,"error");e.on("a",r),e.on("a",n),e.on("all",i),r.returns(!1)["throws"](t),expect(function(){e.trigger("a")}).not.toThrow(),expect(r.called).toBe(!0),expect(n.called).toBe(!0),expect(i.called).toBe(!0),a&&expect(a.calledWith(t.stack)).toBe(!0)}),it("callback context",function(){var e=new o,t=sinon.spy();e.on("a",t),e.trigger("a"),expect(t.calledOn(e)).toBe(!0)}),it("trigger arguments",function(){var e=new o,t=sinon.spy(),n=sinon.spy();e.on("a",t),e.on("all",n),e.trigger("a",1,2,3),expect(t.calledWith(1,2,3)).toBe(!0),expect(n.calledWith("a",1,2,3)).toBe(!0)}),it("#8 mixTo",function(){var e={};e.prototype={bar:1},o.mixTo(e),expect(e.hasOwnProperty("on")).toBe(!0)}),it("once",function(){var e=sinon.spy(),t=sinon.spy(),n=new o,i={};n.once("a",e,i),n.once("all",t,i),n.trigger("b",1),n.trigger("a",1),n.trigger("a",1),expect(e.withArgs(1).calledOnce).toBe(!0),expect(e.calledOn(i)).toBe(!0),expect(t.withArgs("b",1).calledOnce).toBe(!0),expect(t.calledOn(i)).toBe(!0)}),it("#11 triggerEvents should not return undefined",function(){var e=new o;e.on("a",function(){}),expect(e.trigger("all",1)).toBe(!0)}),it("#12 callback should be called only once when trigger",function(){var e=sinon.spy(),t=new o;t.on("all",e),t.trigger("all"),expect(e.callCount).toBe(1)})})},function(e,t,n){var o=n(4);describe("Class",function(){it("Class.create(parent)",function(){function e(e){this.name=e}e.prototype.getName=function(){return this.name};var t=o.create(e),n=new t("Jack");expect(n.constructor).toEqual(t),expect(n.name).toEqual("Jack"),expect(n.getName()).toEqual("Jack")}),it("Class.create(null)",function(){var e=o.create(null),t=new e;expect(t.constructor).toEqual(e),expect(e.superclass.constructor).toEqual(o),e=o.create(),new e,expect(e.superclass.constructor).toEqual(o)}),it("Class.create(parent, properties)",function(){function e(e){this.name=e}e.prototype.getName=function(){return this.name};var t=o.create(e,{talk:function(){return"I am "+this.name}}),n=new t("Jack");expect(n.name).toEqual("Jack"),expect(n.talk()).toEqual("I am Jack")}),it("call initialize method properly",function(){var e=0,t=o.create({initialize:function(){e++}}),n=o.create(t,{initialize:function(){e++}});new n,expect(e).toEqual(1),e=0,n=o.create(t),new n,expect(e).toEqual(1)}),it("pass arguments to initialize method properly",function(){var e=o.create({initialize:function(e,t){this.fullName=e+" "+t}}),t=e.extend({fly:function(){}}),n=new t("Frank","Wang");expect(n.fullName).toEqual("Frank Wang")}),it("superclass",function(){var e=0,t=o.create({initialize:function(){e++},talk:function(){return"I am an animal"}}),n=o.create(t,{initialize:function(){n.superclass.initialize()},talk:function(){return n.superclass.talk()}}),i=new n;expect(e).toEqual(1),expect(i.talk()).toEqual("I am an animal")}),it("Extends",function(){function e(e){this.name=e}e.prototype.getName=function(){return this.name};var t=o.create({Extends:e,talk:function(){return"I am "+this.name}}),n=new t("Jack");expect(n.name).toEqual("Jack"),expect(n.getName()).toEqual("Jack"),expect(n.talk()).toEqual("I am Jack")}),it("Implements",function(){var e=o.create(function(e){this.name=e},{getName:function(){return this.name}}),t={fly:function(){return"I am flying"}},n=function(){};n.prototype.talk=function(){return"I am "+this.name};var i=o.create({Extends:e,Implements:[t,n]}),r=new i("Jack");expect(r.name).toEqual("Jack"),expect(r.getName()).toEqual("Jack"),expect(r.fly()).toEqual("I am flying"),expect(r.talk()).toEqual("I am Jack")}),it("Statics",function(){var e=o.create({initialize:function(e){this.name=e},Statics:{COLOR:"red"}}),t=new e("Jack");expect(t.name).toEqual("Jack"),expect(e.COLOR).toEqual("red")}),it("statics inherited from parent",function(){var e=o.create();e.LEGS=4;var t=o.create({Extends:e,Statics:{COLOR:"red"},initialize:function(e){this.name=e}});expect(t.LEGS).toEqual(4),expect(t.COLOR).toEqual("red");var n=o.create(o);expect(typeof n.implement).toEqual("function"),expect(typeof n.extend).toEqual("function"),expect(typeof n.Mutators).toEqual("undefined"),expect(typeof n.create).toEqual("undefined")}),it("Class.extend",function(){var e=o.extend({initialize:function(e){this.name=e}}),t=new e("Jack");expect(t.name).toEqual("Jack"),expect(e.superclass.constructor).toEqual(o)}),it("SubClass.extend",function(){var e=o.create(function(e){this.name=e}),t=e.extend(),n=new t("Jack");expect(n.name).toEqual("Jack"),expect(t.superclass.constructor).toEqual(e)}),it("SubClass.implement",function(){var e=o.create(function(e){this.name=e}),t=e.extend();t.implement({talk:function(){return"I am "+this.name}});var n=new t("Jack");expect(n.name).toEqual("Jack"),expect(n.talk()).toEqual("I am Jack"),expect(t.superclass.constructor).toEqual(e)}),it("convert existed function to Class",function(){function e(e){this.name=e}o(e).implement({getName:function(){return this.name}});var t=new e("Jack");expect(t.name).toEqual("Jack"),expect(t.getName()).toEqual("Jack");var n=e.extend({talk:function(){return"I am "+this.name}}),i=new n("Frank");expect(i.name).toEqual("Frank")}),it("new AnotherClass() in initialize",function(){var e=[],t=o.create({initialize:function(){e.push("Animal")}}),n=o.create(t,{initialize:function(){e.push("Pig")}}),i=o.create(t,{initialize:function(){new n,e.push("Dog")}});new i,expect(e.join(" ")).toEqual("Pig Dog")}),it("StaticsWhiteList",function(){var e=o.create();e.a=1,e.b=1,e.StaticsWhiteList=["a"];var t=e.extend(e);expect(t.a).toEqual(1),expect(t.b).toEqual(void 0),expect(t.StaticsWhiteList).toEqual(void 0)}),it("Meta information",function(){var e=n(33),t=new e;expect(t.isAnimal).toEqual(!0),expect(t.isDog).toEqual(!0)})})},function(e,t,n){var o=n(34);e.exports=o.extend({isDog:!0})},function(e,t,n){var o=n(4);e.exports=o.create({isAnimal:!0})},function(e,t,n){var o=n(5),i=n(7);describe("Base",function(){it("normal usage",function(){var e=o.extend({initialize:function(e){this.name=e},getName:function(){return this.name}});expect(new e("Tom").name).toEqual("Tom"),expect(new e("Tom2").getName()).toEqual("Tom2");
var t=e.extend({fly:function(){return"I can fly"}}),n=new t("Twitter");expect(n.name).toEqual("Twitter"),expect(n.fly()).toEqual("I can fly")}),it("events supporting",function(){var e=0,t=o.extend({initialize:function(e){this.name=e},fly:function(){this.trigger("fly")}}),n=new t("Twitter");n.on("fly",function(){e++}),expect(e).toEqual(0),n.fly(),expect(e).toEqual(1),n.off().fly(),expect(e).toEqual(1)}),it("attrs merging",function(){var e=o.extend({attrs:{color:"#fff",size:{width:100,height:100}}}),t=new e({color:"#f00",size:{width:200},position:{top:50,left:100}});expect(t.get("color")).toEqual("#f00"),expect(t.get("size").width).toEqual(200),expect(t.get("size").height).toEqual(100),expect(t.get("position").top).toEqual(50),expect(t.get("position").left).toEqual(100)}),it("attrs cloning",function(){var e=o.extend({attrs:{color:"#fff",size:{width:100,height:100}}}),t={width:50,height:50},n=new e({size:t});expect(n.get("color")).toEqual("#fff"),expect(n.get("size")===t).toEqual(!1)}),it("events declaration in config",function(){var e=0,t=o.extend({attrs:{color:"#fff",size:{width:100,height:100}},show:function(){this.trigger("show")}}),n=new t({color:"#f00",size:{width:200},onShow:function(){e++},afterShow:function(){e++},beforeShow:function(){e++},onChangeColor:function(){e++}});n.show(),expect(e).toEqual(3),e=0,n.set("color","#0f0"),expect(e).toEqual(1)}),it("attrs from ancestors",function(){var e=o.extend({attrs:{o1:"p1",o2:"p2",o3:"p3"}}),t=e.extend({attrs:{o3:"m1",o4:"m2"},initialize:function(){t.superclass.initialize.apply(this,arguments)}}),n=t.extend({attrs:{o4:"c1",o5:"c2"},initialize:function(e){e.o6="c6",n.superclass.initialize.apply(this,arguments)}}),i=new n({o4:"o4",o2:"o2"});expect(i.get("o1")).toEqual("p1"),expect(i.get("o2")).toEqual("o2"),expect(i.get("o3")).toEqual("m1"),expect(i.get("o4")).toEqual("o4"),expect(i.get("o5")).toEqual("c2"),expect(i.get("o6")).toEqual("c6")}),it("alipay/arale#49: deep clone bug in initAttrs",function(){var e=o.extend({attrs:{array:[1,2,3],element:null,point:null}}),t=new e({element:document.body}),n=t.attrs;n.array.value.push(4),expect(n.array.value.length).toEqual(4),expect(e.prototype.attrs.array.length).toEqual(3),expect(n.element.value).toEqual(document.body),expect(n.point.value).toEqual(null)}),it("attrs: normal usage",function(){var e=o.extend({attrs:{name:"overlay",x:{value:0},y:{value:0,setter:function(e){return parseInt(e,10)}},xy:{getter:function(){return[this.get("x"),this.get("y")]}}}}),t=new e({x:10});expect(t.get("name")).toEqual("overlay"),expect(t.get("x")).toEqual(10),t.set("y","2px"),expect(t.get("y")).toEqual(2),expect(t.get("xy")).toEqual([10,2])}),it("attrs: inherited ones",function(){var e=o.extend({attrs:{x:"x"}}),t=e.extend({attrs:{x:"x2"}}),n=new t({x:"x3"});expect(n.get("x")).toEqual("x3");var i=e.extend({attrs:{x:{setter:function(){return"x2"}}}}),r=new i;expect(r.get("x")).toEqual("x"),r.set("x","x3"),expect(r.get("x")).toEqual("x2")}),it("related attrs",function(){var e=o.extend({attrs:{x:0,y:0,xy:{getter:function(){return[this.get("x"),this.get("y")]},setter:function(e){this.set("x",e[0]),this.set("y",e[1])}}}}),t=new e({xy:[10,20]});expect(t.get("x")).toEqual(10),expect(t.get("y")).toEqual(20),expect(t.get("xy")).toEqual([10,20]),t=new e({x:30}),expect(t.get("x")).toEqual(30),expect(t.get("y")).toEqual(0),expect(t.get("xy")).toEqual([30,0]),t=new e({xy:[10,20],x:30,y:30}),expect(t.get("x")).toEqual(10),expect(t.get("y")).toEqual(20),expect(t.get("xy")).toEqual([10,20])}),it("related attrs change events",function(){function e(){t++}var t=0,n=o.extend({attrs:{x:0,y:0,xy:{getter:function(){return[this.get("x"),this.get("y")]},setter:function(e){this.set("x",e[0]),this.set("y",e[1])}}},_onChangeX:e,_onChangeY:e,_onChangeXy:e}),i=new n({xy:[10,20],x:30,y:30});expect(i.get("x")).toEqual(10),expect(i.get("y")).toEqual(20),expect(i.get("xy")).toEqual([10,20]),i.change(),expect(t).toEqual(0)}),it("attrs change events",function(){var e=0,t=0,n=o.extend({attrs:{x:1,y:1},_onChangeY:function(e,n){expect(n).toEqual(1),expect(e).toEqual(2),t++}}),i=new n({x:2});i.on("change:x",function(t,n,o){0===e&&(expect(n).toEqual(2),expect(t).toEqual(3)),expect(o).toEqual("x"),expect(this).toEqual(i),e++}),i.set("x",3),i.set("x",3),expect(e).toEqual(1),i.set("x",4,{silent:!0}),expect(e).toEqual(1),i.set("x",5),expect(e).toEqual(2),i.set("y",2),expect(t).toEqual(1),i.set("y",3,{silent:!0}),expect(t).toEqual(1)}),it("example in attribute.md",function(){var e=o.extend({attrs:{y:0,size:{width:100,height:100}},initialize:function(t){e.superclass.initialize.call(this,t),this.element=$(t.element).eq(0)},_onChangeY:function(e){this.element.offset({top:e})}}),t=new e({element:"#test",y:100,size:{width:200}});expect(t.get("y")).toEqual(100),expect(t.get("size").width).toEqual(200),expect(t.get("size").height).toEqual(100)}),it("aspect",function(){var e=1,t=o.extend({xxx:function(t,n){return e+=t+n}}),n=new t;n.before("xxx",function(e,t){expect(e).toEqual(1),expect(t).toEqual(2),expect(this).toEqual(n)}),n.after("xxx",function(t){expect(t).toEqual(4),expect(this).toEqual(n),e++}),n.xxx(1,2),expect(e).toEqual(5),e=1;try{n.before("zzz",function(){})}catch(i){e++}expect(e).toEqual(2)}),it("prevent before event",function(){var e=sinon.spy(),t=sinon.spy(),n=sinon.stub(),i=o.extend({fn:e}),r=(new i).before("fn",n).after("fn",t);n.returns(!1),r.fn(),expect(e.called).not.toBe(!0),expect(t.called).not.toBe(!0),e.reset(),n.reset(),n.returns(!0),r.fn(),expect(e.called).toBe(!0),e.reset(),n.reset(),n.returns(void 0),r.fn(),expect(e.called).toBe(!0),e.reset(),n.reset(),n.returns(""),r.fn(),expect(e.called).toBe(!0),e.reset(),n.reset()}),it("test change method",function(){var e=0,t=o.extend({attrs:{a:1,b:1,c:1},_onChangeA:function(){e++},_onChangeB:function(){e++},_onChangeC:function(){e++}});e=0;var n=new t;expect(e).toEqual(0),n.change(),expect(e).toEqual(0),e=0;var i=new t({a:2});expect(e).toEqual(0),e=0,i.set("a",2),expect(e).toEqual(0),e=0,i.set("a",3),expect(e).toEqual(1),e=0;var r=new t({a:1,b:2,c:3});expect(e).toEqual(0),e=0,r.set({a:2,b:3,c:4}),expect(e).toEqual(3)}),it("after/before support binding multiple methodNames at once",function(){function e(){t++}var t=0,n=o.extend({show:function(){},hide:function(){}}),i=new n;i.before("show hide",e),i.after("hide show",e),i.show(),expect(t).toEqual(2),i.hide(),expect(t).toEqual(4)}),it("special properties getter",function(){var e=o.extend({model:{getter:function(e){return{a:1,v:e}}},propsInAttrs:["model"]}),t=new e;expect(t.model.a).toEqual(1),expect(t.model.v).toEqual(void 0)}),it("#2 share instance",function(){var e=o.extend({attrs:{date:2},initialize:function(){e.superclass.initialize.call(this),this.set("date",2)}}),t=new e,n=new e;expect(t.get("date")).toEqual(2),expect(n.get("date")).toEqual(2),t.set("date",4),expect(t.get("date")).toEqual(4),expect(n.get("date")).toEqual(2)}),it("#3 attrs can not be { value: 1 }",function(){var e=o.extend({attrs:{source:null}}),t=new e({source:{value:"a"}});expect(t.get("source")).toEqual({value:"a"})}),it("#4 the merging bug of jQuery-like object",function(){var e=o.extend({attrs:{baseElement:{_id:1}}}),t=new e({baseElement:$({})});expect(t.get("baseElement")._id).toEqual(void 0)}),it("#16 after callback should pass arguments from method",function(){var e=sinon.spy(),t=o.extend({show:function(){return 1}}),n=(new t).after("show",e);n.show("a","b"),expect(e.calledWith(1,"a","b")).toBe(!0)}),it("destroy",function(){var e=sinon.spy(),t=o.extend({initialize:function(){this.a=1}}),n=new t;n.on("a",e),expect(n.a).toBe(1),n.trigger("a"),expect(e.called).toBe(!0),e.reset(),n.destroy(),expect(n.a).toBe(void 0),n.trigger("a"),expect(e.called).not.toBe(!0),e.reset()}),it("can not set readOnly attr",function(){var e=o.extend({attrs:{a:{value:1,readOnly:!0}}}),t=new e;expect(function(){t.set("a",2)}).toThrow()}),it("attr can be overrided",function(){var e=o.extend({attrs:{a:{b:1,c:2}}}),t=new e;t.set("a",{b:3}),expect(t.get("a")).toEqual({b:3,c:2}),t.set("a",{b:3},{override:!0}),expect(t.get("a")).toEqual({b:3})}),it("change silent attr manually",function(){var e=sinon.spy(),t=o.extend({attrs:{a:1},_onChangeA:e}),n=new t;n.set("a",2,{silent:!0}),expect(e.called).not.toBe(!0),n.change(),expect(e.called).toBe(!0)}),it("other attr format",function(){var e=o.extend({attrs:{a:!0,b:/a/g}}),t=new e;t.set("a",!1),t.set("b",/b/g),expect(t.get("a")).toBe(!1),expect(t.get("b")).toEqual(/b/g)}),it("isPlainObject #19",function(){function e(){this.c="c",this.d="d"}e.prototype={a:"a",b:"b"},expect(i._isPlainObject(new e)).not.toBe(!0)}),it("setter need userValue",function(){var e=sinon.spy(),t={VIEWPORT:{_id:"VIEWPORT",nodeType:1}},n=o.extend({attrs:{align:{selfXY:[0,0],baseElement:t.VIEWPORT,baseXY:[0,0]}}}),i=n.extend({attrs:{align:{value:{baseXY:[0,"100%"],selfXY:[0,0]},setter:function(t){e(t)}}}});new i({align:{baseXY:[0,0]}});expect(e.calledWith({baseXY:[0,0]})).toBe(!0)}),it("destroy once",function(){var e=0,t=0,n=o.extend({destroy:function(){e++,n.superclass.destroy.call(this)}}),i=n.extend({destroy:function(){t++,i.superclass.destroy.call(this)}}),r=new i;r.destroy(),r.destroy(),expect(e).toBe(1),expect(t).toBe(1)}),it("isEmptyObject #22",function(){$("<div id='test'></div>").appendTo("body");var e=o.extend({attrs:{parentNode:document.body}}),t=new e;t.set("parentNode",$("#test")[0]),expect(t.get("parentNode")).toEqual($("#test")[0]),t.set("parentNode",document),expect(t.get("parentNode")).toEqual(document),t.set("parentNode",{}),expect(t.get("parentNode")).toEqual({}),t.set("parentNode",window),expect(t.get("parentNode")).toEqual(window),t.set("parentNode",void 0),expect(t.get("parentNode")).toEqual(void 0),t.set("parentNode",[]),expect(t.get("parentNode")).toEqual([]),t.set("parentNode",{}),expect(t.get("parentNode")).toEqual({}),t.set("parentNode",null),expect(t.get("parentNode")).toEqual(null),t.set("parentNode",$("#test")),expect(t.get("parentNode")).toEqual($("#test")),t.set("parentNode",Number.MAX_VALUE),expect(t.get("parentNode")).toEqual(Number.MAX_VALUE),t.set("parentNode",location),expect(t.get("parentNode")).toEqual(location);var n=new String;t.set("parentNode",n),expect(t.get("parentNode")).toEqual(n);var i=new Array;t.set("parentNode",i),expect(t.get("parentNode")).toEqual(i);var r=new Object;t.set("parentNode",r),expect(t.get("parentNode")).toEqual(r);var a=new Number;t.set("parentNode",a),expect(t.get("parentNode")).toEqual(a),t.set("parentNode",{}),expect(t.get("parentNode")).toEqual({});var c=function(){};t.set("parentNode",c),expect(t.get("parentNode")).toEqual(c),$("#test").remove()}),it("attribuet start with _",function(){var e=sinon.spy(),t=o.extend({attrs:{_a:""},_onChange_a:e}),n=new t;n.set("_a","a"),expect(n.get("_a")).toBe("a"),expect(e.calledOnce).toBe(!0)})})},function(e,t,n){var o=n(9),i=n(10);describe("Widget.AutoRender",function(){it("auto render all",function(e){var t=o('<div id="test1" data-widget="widget/widget" widget-options="className:\'widget\',id:\'test1\'"></div>');t.appendTo(document.body),i.autoRenderAll(function(){var n=i.query("#test1");expect(n.get("id")).toBe("test1"),expect(n.get("className")).toBe("widget"),expect(n.element[0]).toBe(t[0]),t.remove(),n.destroy(),e&&e()})}),it("auto render trigger",function(e){var t=o('<div id="element2">element2</div>').appendTo(document.body),n=o('<div id="test2" data-widget="widget/widget" widget-role="trigger" widget-options="element: \'#element2\',className:\'widget\'"></div>');n.appendTo(document.body),i.autoRenderAll(function(){var o=i.query("#test2");expect(o.get("className")).toBe("widget"),expect(o.get("trigger")[0]).toBe(n[0]),expect(o.element.html()).toBe("element2"),n.remove(),t.remove(),o.destroy(),e&&e()})}),it("auto render with data attrs",function(e){var t=o('<div id="element3">element3</div>').appendTo(document.body),n=o('<div id="test3" data-widget="widget/widget" widget-role="trigger" widget-options="element: \'#element3\',trigger:\'trigger\'"></div>');n.appendTo(document.body),i.autoRenderAll(function(){var o=i.query("#test3");expect(o.get("trigger")).toBe("trigger"),expect(o.element.html()).toBe("element3"),n.remove(),t.remove(),o.destroy(),e&&e()})}),it("render element with data attrs",function(){var e=o('<div id="test3" data-widget="widget/widget" widget-options="a:1"></div>');e.appendTo(document.body);var t=new i({element:"#test3",a:2});expect(t.get("a")).toBe(2),e.remove(),t.destroy()}),it("auto render template",function(e){var t=o('<div id="tpl"><p>element</p></div>').appendTo(document.body),n=o('<div id="test4" data-widget="widget/widget" widget-role="trigger" widget-options="template:\'#tpl\'"></div>');n.appendTo(document.body),i.autoRenderAll(function(){var o=i.query("#test4");expect(o.element.html().toLowerCase()).toBe("<p>element</p>"),n.remove(),t.remove(),o.destroy(),e&&e()})})})},function(e,t,n){var o=n(9),i=n(10);describe("Widget",function(){var e={};afterEach(function(){for(var t in e)e[t].destroy();e={}}),it("initAttrs",function(){var t=o('<div id="a"></div>').appendTo(document.body),n=i.extend({attrs:{element:"#default",foo:"foo",template:"<span></span>",model:{title:"default title",content:"default content"}}}),r=e.a=new n({element:"#a",bar:"bar",template:"<a></a>",model:{title:"title a"}});expect(r.get("bar")).toEqual("bar"),expect(r.get("foo")).toEqual("foo"),expect(r.get("template")).toEqual("<a></a>"),expect(r.get("model").title).toEqual("title a"),expect(r.get("model").content).toEqual("default content"),expect(r.element[0].id).toEqual("a"),t.remove()}),it("parseElement",function(){var t=o('<div id="a"></div>').appendTo(document.body),n=e.widget=new i;expect(n.element[0].tagName).toEqual("DIV"),n=e.widget=new i({element:"#a"}),expect(n.element[0].id).toEqual("a"),n=e.widget=new i({element:document.getElementById("a")}),expect(n.element[0].id).toEqual("a"),n=e.widget=new i({element:o("#a")}),expect(n.element[0].id).toEqual("a");try{new i({element:"#b"}),expect("应该抛错").toEqual("没有抛错")}catch(r){}n=e.widget=new i({element:"#a",template:"<span></span>"}),expect(n.element[0].tagName).toEqual("DIV"),n=e.widget=new i({template:"<span></span>"}),expect(n.element[0].tagName).toEqual("SPAN"),t.remove()}),describe("delegateEvents / undelegateEvents",function(){it("delegateEvents()",function(){var t,n=sinon.spy(),o=sinon.spy(),r=sinon.spy(),a=i.extend({events:{"click p":"fn1","click li":"fn2","mouseenter span":"fn3"},fn1:n,fn2:o,fn3:function(e){r(),t=e,that=this}}),c=e.widget=new a({template:"<div><p></p><ul><li></li></ul><span></span></div>"}).render();c.$("p").trigger("click"),expect(n.called).toBe(!0),n.reset(),c.$("li").trigger("click"),expect(o.called).toBe(!0),o.reset(),c.element.trigger("click"),expect(n.called).not.toBe(!0),expect(o.called).not.toBe(!0),n.reset(),o.reset(),c.$("span").trigger("mouseenter"),expect(r.called).toBe(!0),expect(t.currentTarget.tagName).toEqual("SPAN"),expect(that).toEqual(c)}),it("delegateEvents(eventsObject)",function(){var t=sinon.spy(),n=sinon.spy(),o=i.extend({fn1:t}),r=e.widget=new o({template:"<div><p></p><ul><li></li></ul><span></span></div>"}).render();r.delegateEvents({"click p":"fn1","click span":n}),r.$("p").trigger("click"),expect(t.called).toBe(!0),r.$("span").trigger("click"),expect(t.called).toBe(!0)}),it("delegateEvents(events, handler)",function(){var t=sinon.spy(),n=e.widget=new i({template:"<div><p></p><ul><li></li></ul><span></span></div>"}).render();n.delegateEvents("click p",t),n.$("p").trigger("click"),expect(t.called).toBe(!0)}),it("delegateEvents(element, events, handler)",function(){var t=o("<div><p></p></div>"),n=sinon.spy(),r=sinon.spy(),a=e.widget=new i({template:"<div><p></p><ul><li></li></ul><span></span></div>"}).render();a.delegateEvents(t,"click",n),a.delegateEvents(t,"click p",r),a.$("p").trigger("click"),expect(r.called).not.toBe(!0),t.trigger("click"),expect(n.called).toBe(!0),expect(r.called).not.toBe(!0),n.reset(),r.reset(),t.find("p").trigger("click"),expect(n.called).toBe(!0),expect(r.called).toBe(!0)}),it("delegateEvents support normal element",function(){var e=o("<div><p></p></div>")[0],t=sinon.spy(),n=new i({template:"<div><p></p><ul><li></li></ul><span></span></div>"}).render();n.delegateEvents(e,"click",t),o(e).trigger("click"),expect(t.called).toBe(!0),n.destroy()}),it("undelegateEvents()",function(){var t=sinon.spy(),n=sinon.spy(),r=sinon.spy(),a=e.widget=new i({template:"<div><p></p><ul><li></li></ul><span></span></div>"}).render();a.delegateEvents({"click p":t,mouseenter:n});var c=o("<div></div>");a.delegateEvents(c,"click",r),a.$("p").trigger("click"),a.element.trigger("mouseenter"),c.trigger("click"),expect(t.called).toBe(!0),expect(n.called).toBe(!0),expect(r.called).toBe(!0),t.reset(),n.reset(),r.reset(),a.undelegateEvents(),a.$("p").trigger("click"),a.element.trigger("mouseenter"),c.trigger("click"),expect(t.called).not.toBe(!0),expect(n.called).not.toBe(!0),expect(r.called).not.toBe(!0)}),it("undelegateEvents(events)",function(){var t=sinon.spy(),n=sinon.spy(),o=sinon.spy(),r=e.widget=new i({template:"<div><p></p><ul><li></li></ul><span></span></div>"}).render();r.delegateEvents({"click p":t,"click span":n,"click li":o}),r.$("p").trigger("click"),r.$("span").trigger("click"),r.$("li").trigger("click"),expect(t.called).toBe(!0),expect(n.called).toBe(!0),expect(o.called).toBe(!0),t.reset(),n.reset(),o.reset(),r.undelegateEvents("click span"),r.$("p").trigger("click"),r.$("span").trigger("click"),r.$("li").trigger("click"),expect(t.called).toBe(!0),expect(n.called).not.toBe(!0),expect(o.called).toBe(!0),t.reset(),n.reset(),o.reset(),r.undelegateEvents("click"),r.$("p").trigger("click"),r.$("span").trigger("click"),r.$("li").trigger("click"),expect(t.called).not.toBe(!0),expect(n.called).not.toBe(!0),expect(o.called).not.toBe(!0)}),it("undelegateEvents(element, events)",function(){var t=o("<div><p></p><ul><li></li></ul><span></span></div>"),n=sinon.spy(),r=sinon.spy(),a=sinon.spy(),c=e.widget=new i({template:"<div><p></p><ul><li></li></ul><span></span></div>"}).render();c.delegateEvents(t,"click p",n),c.delegateEvents(t,"click li",r),c.delegateEvents(t,"click span",a),c.undelegateEvents(t,"click li"),t.find("p").trigger("click"),t.find("li").trigger("click"),t.find("span").trigger("click"),expect(n.called).toBe(!0),expect(r.called).not.toBe(!0),expect(a.called).toBe(!0),n.reset(),r.reset(),a.reset(),c.undelegateEvents(t,"click"),t.find("p").trigger("click"),t.find("li").trigger("click"),t.find("span").trigger("click"),expect(n.called).not.toBe(!0),expect(r.called).not.toBe(!0),expect(a.called).not.toBe(!0)}),it("#66 extend delegateEvents",function(){var t=sinon.spy(),n=i.extend({events:{"click p":t},delegateEvents:function(e,t,o){return n.superclass.delegateEvents.call(this,e,t,o)},undelegateEvents:function(e,t){return n.superclass.undelegateEvents.call(this,e,t)}}),o=e.widget=new n({template:"<div><p></p><ul><li></li></ul><span></span></div>"}).render();o.$("p").trigger("click"),expect(t.called).toBe(!0)})}),it("events hash can be a function",function(){var t=0,n=i.extend({events:function(){return{"click h3":"incr","click p":"incr"}},incr:function(){t++}}),o=e.widget=new n({template:"<div><h3></h3><p></p></div>"}).render();o.$("h3").trigger("click"),expect(t).toEqual(1),t=0,o.$("p").trigger("click"),expect(t).toEqual(1)}),it("the default event target is `this.element`",function(){var t=0,n=i.extend({events:function(){return{click:"incr"}},incr:function(){t++}}),o=e.widget=(new n).render();o.element.trigger("click"),expect(t).toEqual(1)}),it("parentNode is a document fragment",function(){var e="test"+new Date,t=o('<div id="'+e+'"></div><div></div>');new i({element:t.eq(0),parentNode:document.body}).render(),expect(document.getElementById(e).nodeType).toEqual(1)}),it("template in delegate-events",function(){var t=0,n=i.extend({attrs:{buttons:"button"},events:{"click p":"incr","click button":"incr"},incr:function(){t++}}),r=e.a=new n({template:'<div><header>x</header><button>x</button><p>x</p><div id="ttt"></div></div>'}).render();r.$("p").trigger("click"),expect(t).toEqual(1),t=0,o(r.get("buttons")).trigger("click"),expect(t).toEqual(1)}),it("delegate events inherited from ancestors",function(){function t(){n++}var n=0,o=i.extend({events:{"click p":t}}),r=o.extend({events:{"click div":t}}),a=e.object=new r({template:"<section><p></p><div></div><span></span></section>",events:{"click span":t}}).render();n=0,a.$("p").trigger("click"),expect(n).toEqual(1),n=0,a.$("div").trigger("click"),expect(n).toEqual(1),n=0,a.$("span").trigger("click"),expect(n).toEqual(1)}),it("#76: set default attrs automatically",function(){var t=i.extend({attrs:{a:1,b:1},_onRenderA:function(e){this.a=e}}),n=e.a=new t({b:2});expect(n.get("a")).toEqual(1),expect(n.get("b")).toEqual(2),expect(n.a).toEqual(void 0),n.render(),expect(n.a).toEqual(1)}),it("set attribute before render method",function(){var t=[],n=[],o=i.extend({attrs:{a:1},_onRenderA:function(e,o){t.push(e),n.push(o)}}),r=e.a=new o({a:2});r.set("a",3),r.render(),expect(t.join()).toEqual("3"),expect(n.join()).toEqual("")}),it("default values in attrs",function(){var t=sinon.spy(),n=sinon.spy(),o=sinon.spy(),r=sinon.spy(),a=sinon.spy(),c=sinon.spy(),l=sinon.spy(),s=sinon.spy(),p=sinon.spy(),u=i.extend({attrs:{bool:!1,str:"",str2:"x",obj:{},obj2:{a:1},arr:[],n:null,u:void 0,fn:function(){}},_onRenderBool:t,_onRenderStr:n,_onRenderStr2:o,_onRenderObj:r,_onRenderObj2:a,_onRenderArr:c,_onRenderN:l,_onRenderU:s,_onRenderFn:p}),f=e.a=new u;expect(t.calledOnce).not.toBe(!0),expect(n.calledOnce).not.toBe(!0),expect(o.calledOnce).not.toBe(!0),expect(r.calledOnce).not.toBe(!0),expect(a.calledOnce).not.toBe(!0),expect(c.calledOnce).not.toBe(!0),expect(l.calledOnce).not.toBe(!0),expect(s.calledOnce).not.toBe(!0),expect(p.calledOnce).not.toBe(!0),f.render(),expect(t.calledOnce).toBe(!0),expect(n.calledOnce).toBe(!0),expect(o.calledOnce).toBe(!0),expect(r.calledOnce).toBe(!0),expect(a.calledOnce).toBe(!0),expect(c.calledOnce).toBe(!0),expect(l.calledOnce).not.toBe(!0),expect(s.calledOnce).not.toBe(!0),expect(p.calledOnce).toBe(!0),t.reset(),o.reset();e.b=new u({bool:null,str2:""}).render();expect(t.called).not.toBe(!0),expect(o.calledOnce).toBe(!0)}),it("call render() after first render",function(){function t(){n++}var n=0,o=i.extend({attrs:{a:1},_onRenderA:t}),r=e.a=new o;r.render(),expect(n).toEqual(1),r.render(),expect(n).toEqual(1)}),it("statics white list",function(){var e=i.extend();expect(typeof e.autoRender).toEqual("function"),expect(typeof e.autoRenderAll).toEqual("undefined")}),it("data attr api",function(){var t=(o('<div id="data-attr-api-test" widget-options=\'a:1,b:"b",arr:[1,2,3],c:true,d:{num: 1, str: "s", bool: true}\'></div>').appendTo(document.body),e.t=new i({element:"#data-attr-api-test",b:"b2"}));expect(t.get("a")).toEqual(1),expect(t.get("b")).toEqual("b2"),expect(t.get("c")).toEqual(!0),expect(t.get("d").num).toEqual(1),expect(t.get("d").str).toEqual("s"),expect(t.get("d").bool).toEqual(!0),expect(t.get("arr")).toEqual([1,2,3])}),it("onXx setter in attrs",function(){function t(){n++}var n=0,o={a:t},r=i.extend({attrs:{onXx:function(){n++},onYy:{setter:function(e){return o[e]}}},test:function(){this.trigger("xx"),this.trigger("yy")}}),a=e.t=new r({onYy:"a"});a.test(),expect(n).toEqual(2)}),it("inherited attrs",function(){var t=i.extend({attrs:{a:"",b:null}}),n=t.extend({attrs:{a:"1"}}),o=n.extend({attrs:{a:"2",b:"b"}}),r=e.c=new o;expect(r.get("a")).toEqual("2"),expect(r.get("b")).toEqual("b")}),it("#3: parentNode is a jQuery object",function(){o('<div id="test1"></div>').appendTo("body");var t=e.w=new i({parentNode:o("#test1")});t.render(),expect(o("#test1 div").html()).toEqual(""),o("#test1").remove()}),it("override object in prototype",function(){var t=i.extend({o:{p1:"1"}}),n=t.extend({o:{p2:"2"}}),o=e.c=new n;expect(o.o.p1).toEqual(void 0),expect(o.o.p2).toEqual("2")}),it("mix events object in prototype",function(){var t=i.extend({events:{p1:"1"}}),n=t.extend({events:{p2:"2"}}),o=e.c=new n;expect(o.events.p1).toEqual("1"),expect(o.events.p2).toEqual("2")}),it("#38 destroy",function(){var e=new i({template:'<div id="destroy"><a></a></div>'}).render();expect(e.element[0]).toEqual(o("#destroy")[0]),e.destroy(),expect(o("#destroy")[0]).toBe(void 0),expect(e.element).toBe(null)}),it("#25 destroy is called twice",function(){var e=new i({template:'<div id="destroy"><a></a></div>'}).render();expect(function(){e.destroy(),e.destroy()}).not.toThrow()}),it("style attribute",function(){var e=new i({style:{padding:"1px"},template:'<div id="destroy"><a></a></div>'}).render();expect(e.element.css("paddingTop")).toBe("1px")}),it("_isTemplate",function(){var e=o('<p id="test"></p>').appendTo(document.body),t=new i({element:"#test"});expect(t.__isTemplate).not.toBe(!0);var n=new i;expect(n.__isTemplate).toBe(!0);var r=new i({template:"<p></p>"});expect(r.__isTemplate).toBe(!0),e.remove()}),it("attr change callback",function(){var e=sinon.spy(),t=i.extend({attrs:{a:1},_onChangeA:e}),n=new t;n.set("a",2),expect(e.calledOnce).toBe(!0)}),it("set call onRender",function(){var e=sinon.spy(),t=i.extend({attrs:{a:1},_onRenderA:e}),n=new t;n.render(),expect(e.calledOnce).toBe(!0),n.set("a",2),expect(e.calledTwice).toBe(!0)}),it("destroy once",function(){var e=0,t=0,n=i.extend({destroy:function(){e++,n.superclass.destroy.call(this)}}),o=n.extend({destroy:function(){t++,o.superclass.destroy.call(this)}}),r=(new o).render();r.destroy(),r.destroy(),expect(e).toBe(1),expect(t).toBe(1)}),it("set attribute to htmlElement",function(){var e=i.extend({attrs:{testElement:null}}),t=new e;t.set("testElement",document.body),expect(t.get("testElement")).toBe(document.body)})})},function(e,t,n){var o=n(11),i=n(10);n(9);describe("Templatable",function(){var e={};afterEach(function(){for(var t in e)e[t].destroy();e={}});var t=i.extend({Implements:o});it("normal usage",function(){var n=e.widget=new t({template:"<div><h3><%=title%></h3><p><%=content%></p></div>",model:{title:"Big Bang",content:"It is very cool."}});expect(n.$("h3").text()).toEqual("Big Bang"),expect(n.$("p").text()).toEqual("It is very cool.")}),it("model.toJSON()",function(){var n=t.extend({}),o=e.a=new n({template:"<div><%=content%></div>",model:{toJSON:function(){return{content:"xx"}}}});o.render(),expect(o.element.html()).toEqual("xx")})})},function(e,t,n){var o=n(13),i=n(9);describe("position",function(){var e,t,n;i(document.body).css({margin:0,padding:0,overflow:"scroll"}),beforeEach(function(){e=i('<div style="width:100px;height:100px;position:absolute;top:0;left:0;" id="pin-element">pinElement</div>').prependTo(document.body),n=i("<div></div>").prependTo(document.body),t=i('<div style="margin:20px;border:5px solid #000;padding:20px;width:200px;height:200px;" id="base-element">baseElement</div>').prependTo(document.body)}),afterEach(function(){t.remove(),n.remove(),e.remove()}),it("相对屏幕定位：Position.pin(pinElement, { x: 100, y: 100 })",function(){o.pin(e,{x:100,y:100}),expect(e.offset().top).toEqual(100),expect(e.offset().left).toEqual(100)}),it("基本情况：Position.pin({ element: pinElement, x: 0, y: 0 }, { element:baseElement, x: 100, y: 100 })",function(){o.pin({element:e,x:0,y:0},{element:t,x:100,y:100}),expect(e.offset().top).toEqual(120),expect(e.offset().left).toEqual(120)}),it("第一个参数简略写法：Position.pin(pinElement, { element:baseElement, x: 100, y: 100 })",function(){o.pin({element:e,x:0,y:0},{element:t,x:100,y:100}),expect(e.offset().top).toEqual(120),expect(e.offset().left).toEqual(120)}),it("第二个参数简略写法：Position.pin({ element:pinElement, x: -100, y: -100 }, baseElement)",function(){o.pin({element:e,x:-100,y:-100},t),expect(e.offset().top).toEqual(120),expect(e.offset().left).toEqual(120)}),it("两个参数都简略：Position.pin(pinElement, baseElement)",function(){o.pin(e,t),expect(e.offset().top).toEqual(20),expect(e.offset().left).toEqual(20)}),it('省略x参数：Position.pin(pinElement, { element:baseElement, x: "99px" })',function(){o.pin(e,{element:t,x:"99px"}),expect(e.offset().top).toEqual(20),expect(e.offset().left).toEqual(119)}),it('省略y参数：Position.pin(pinElement, { element:baseElement, y: "99px" })',function(){o.pin(e,{element:t,y:"99px"}),expect(e.offset().top).toEqual(119),expect(e.offset().left).toEqual(20)}),it('带px的字符串参数：Position.pin(pinElement, { element:baseElement, x: "100px", y: "100px" })',function(){o.pin({element:e,x:0,y:0},{element:t,x:"100px",y:"100px"}),expect(e.offset().top).toEqual(120),expect(e.offset().left).toEqual(120)}),it('参数传递选择器：Position.pin("#pin-element", { element:"#base-element", x: "100px", y: "100px" })',function(){o.pin("#pin-element",{element:"#base-element",x:"100px",y:"100px"}),expect(e.offset().top).toEqual(120),expect(e.offset().left).toEqual(120)}),it('参数传递原生对象：Position.pin(pinElement[0], { element:baseElement[0], x: "100px", y: "100px" })',function(){o.pin(e[0],{element:t[0],x:"100px",y:"100px"}),expect(e.offset().top).toEqual(120),expect(e.offset().left).toEqual(120)}),it("负数定位点：Position.pin({ element: pinElement, x: -100, y: -100 }, { element:baseElement, x: 0, y: 0 })",function(){o.pin({element:e,x:-100,y:-100},{element:t,x:0,y:0}),expect(e.offset().top).toEqual(120),expect(e.offset().left).toEqual(120)}),it('百分比：Position.pin(pinElement, { element:baseElement, x: "100%", y: "50%" })',function(){o.pin(e,{element:t,x:"100%",y:"50%"}),expect(e.offset().top).toEqual(145),expect(e.offset().left).toEqual(270)}),it('负百分比：Position.pin(pinElement, { element:baseElement, x: "-100%", y: "-50%" })',function(){o.pin(e,{element:t,x:"-100%",y:"-50%"}),expect(e.offset().top).toEqual(-105),expect(e.offset().left).toEqual(-230)}),it('很大的百分比：Position.pin(pinElement, { element:baseElement, x: "1000%", y: "500%" })',function(){o.pin(e,{element:t,x:"1000%",y:"500%"}),expect(e.offset().top).toEqual(1270),expect(e.offset().left).toEqual(2520)}),it('别名：Position.pin({ element:pinElement, x: "left", y: "left" }, { element:baseElement, x: "right", y: "center" })',function(){o.pin({element:e,x:"left",y:"left"},{element:t,x:"right",y:"center"}),expect(e.offset().top).toEqual(145),expect(e.offset().left).toEqual(270)}),it('大写的别名：Position.pin({ element:pinElement, x: "LEFT", y: "LEFT" }, { element:baseElement, x: "RIGHT", y: "CENTER" })',function(){o.pin({element:e,x:"LEFT",y:"LEFT"},{element:t,x:"RIGHT",y:"CENTER"}),expect(e.offset().top).toEqual(145),expect(e.offset().left).toEqual(270)}),it('百分比小数：Position.pin(pinElement, { element:baseElement, x: "99.5%", y: "50.5%" })',function(){o.pin(e,{element:t,x:"99.5%",y:"50.5%"}),expect(e.offset().top).toBeGreaterThan(145.99),expect(e.offset().top).toBeLessThan(147.01),expect(e.offset().left).toBeGreaterThan(267.99),expect(e.offset().left).toBeLessThan(269.01)}),it("居中定位：Position.center(pinElement, baseElement);",function(){o.center(e,t),expect(e.offset().top).toEqual(95),expect(e.offset().left).toEqual(95)}),it("屏幕居中定位：Position.center(pinElement);",function(){o.center(e),expect((i(window).outerHeight()-100)/2).toBeGreaterThan(e.offset().top-.51),expect((i(window).outerHeight()-100)/2).toBeLessThan(e.offset().top+.51),expect((i(window).outerWidth()-100)/2).toBeGreaterThan(e.offset().left-.51),expect((i(window).outerWidth()-100)/2).toBeLessThan(e.offset().left+.51)}),it("baseElement绝对定位：",function(){t.css({position:"absolute",top:"20px",left:"30px"}),o.pin(e,{element:t,x:100,y:100}),expect(parseInt(e.offset().top)).toEqual(140),expect(parseInt(e.offset().left)).toEqual(150)}),it("baseElement相对定位：",function(){t.css({position:"relative",top:"-20px",left:"30px"}),o.pin(e,{element:t,x:100,y:100}),expect(parseInt(e.offset().top)).toEqual(100),expect(parseInt(e.offset().left)).toEqual(150)}),it("offsetParent不为body：",function(){var n=i('<div style="margin:20px;border:10px solid #000;padding:20px;position:relative;"></div>').appendTo(document.body);t.appendTo(n),o.pin(e,{element:t,x:100,y:100}),expect(parseInt(e.offset().top)-parseInt(t.offset().top)).toEqual(100),expect(parseInt(e.offset().left)-parseInt(t.offset().left)).toEqual(100),n.remove()}),it("offsetParent绝对定位：",function(){
var n=i('<div style="position:absolute;top:50px;left:50px;"></div>').appendTo(document.body);t.appendTo(n),o.pin(e,{element:t,x:100,y:100}),expect(parseInt(e.offset().top)).toEqual(170),expect(parseInt(e.offset().left)).toEqual(170),n.remove()}),it("offsetParent相对定位：",function(){var n=i('<div style="position:relative;top:50px;left:50px;"></div>').prependTo(document.body);t.appendTo(n),o.pin(e,{element:t,x:100,y:100}),expect(parseInt(e.offset().top)).toEqual(170),expect(parseInt(e.offset().left)).toEqual(170),n.remove()}),it("加号应用：",function(){o.pin(e,{element:t,x:"100%+20px",y:"50%+15px"}),expect(parseInt(e.offset().top)).toEqual(160),expect(parseInt(e.offset().left)).toEqual(290)}),it("减号应用：",function(){o.pin(e,{element:t,x:"100%-20px",y:"50%-15px"}),expect(parseInt(e.offset().top)).toEqual(130),expect(parseInt(e.offset().left)).toEqual(250)}),it("加减号混用：",function(){o.pin(e,{element:t,x:"100%-20px+10px",y:"50%-15px+5px"}),expect(parseInt(e.offset().top)).toEqual(135),expect(parseInt(e.offset().left)).toEqual(260)}),it("0% 的情况",function(){o.pin(e,{element:t,x:"0%",y:"0%"}),expect(parseInt(e.offset().top)).toEqual(20),expect(parseInt(e.offset().left)).toEqual(20)}),it("Position.VIEWPORT",function(){expect(o.VIEWPORT._id).toEqual("VIEWPORT"),expect(o.VIEWPORT.nodeType).toEqual(1)}),it("Position.VIEWPORT 作为第二个参数（简略）",function(){o.pin(e,o.VIEWPORT),expect(parseInt(e.offset().top)).toEqual(0),expect(parseInt(e.offset().left)).toEqual(0)}),it("Position.VIEWPORT 作为第二个参数（完整）",function(){o.pin(e,{element:o.VIEWPORT,x:25,y:30}),expect(parseInt(e.offset().top)).toEqual(30),expect(parseInt(e.offset().left)).toEqual(25)}),it("fixed定位：",function(){e.css("position","fixed"),o.pin(e,{x:"300px",y:250});var t=(window.navigator.userAgent||"").toLowerCase();-1!==t.indexOf("msie 6")?expect(e.css("position")).toEqual("absolute"):expect(e.css("position")).toEqual("fixed"),expect(e.css("top")).toEqual("250px"),expect(e.css("left")).toEqual("300px")}),it("support 0%+10px",function(){o.pin({element:e,x:"0%+20px",y:"0%+20px"},{element:t,x:100,y:100}),expect(parseInt(e.offset().top)).toEqual(100),expect(parseInt(e.offset().left)).toEqual(100)}),it("body 有 margin 的情况",function(){i(document.body).css({marginTop:50,marginLeft:50}),o.pin(e,t),expect(e.offset().top).toEqual(t.offset().top),expect(e.offset().left).toEqual(t.offset().left),i(document.body).css({margin:0})}),it("body 是 absolute 的情况",function(){i(document.body).css({position:"absolute",top:20,left:20}),o.pin(e,t),expect(parseInt(e.offset().top)).toEqual(40),expect(parseInt(e.offset().left)).toEqual(40),i(document.body).css({position:"",top:"",left:""})}),it("body 是 relative 的情况",function(){i(document.body).css({position:"relative",top:20,left:20}),o.pin(e,t),expect(parseInt(e.offset().top)).toEqual(40),expect(parseInt(e.offset().left)).toEqual(40),i(document.body).css({position:"",top:"",left:""})}),it("scroll 1000px 之后",function(){var n=i("<div style='height:1000px;'></div>").prependTo(document.body);i(document).scrollTop(500),o.pin(e,t),expect(parseInt(e.offset().top)>1e3).toBe(!0),n.remove()})})}]);