<!doctype html>
<html lang="">
<head>
	<meta charset="UTF-8" />
	<title>Messenger-飞牛前端UED</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="nico 0.5.2" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">


	<script type="text/javascript">
		var ctx = '../../';
	</script>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css">
<link rel="stylesheet" href="../../static/css/site.css" />
 <link rel="stylesheet" href="../../static/css/fnx.min.css" />

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../static/js/fnx.min.js"></script>


</head>


<body>
<header class="navbar navbar-default navbar-static-top doc-nav">
	<div class="container">
		<div class="navbar-header">
			<a href="../../readme.html" class="logo"><i class="logo-icon"></i><span>FNX UI</span></a>

			<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#fnx-navbar" aria-controls="fnx-navbar" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
		</div>

		<nav id="fnx-navbar" class="navbar-collapse collapse" aria-expanded="false">
			<ul class="nav navbar-nav navbar-right">
				<li><a href="../../readme.html">首页</a></li>
				<li><a href="../../tutorial/readme.html">快速上手</a></li>
				<li><a href="../readme.html">文档</a></li>
				<li><a href="https://github.com/Rockcookies/fnx">GITHUB</a></li>
			</ul>
		</nav>
	</div>
</header>

<div class="doc-header">
	<div class="container">
		<h1>Messenger</h1>
		<p>跨域 Iframe 通信解决方案，兼容主流和 IE 系列浏览器。</p>
	</div>
</div>

<div class="doc-body">
	<div class="container">
		<div class="row">
			<div id="doc-nav" class="col-md-3 doc-sidebar hidden-sm hidden-xs" data-role="aside">
				<ul class="nav" data-spy="affix" data-offset-top="330"></ul>
			</div>

			<div id="doc-content" class="col-md-9 doc-content" data-role="main">
<h1 id="父页面">父页面<a href="#父页面" class="anchor">¶</a></h1><div class="highlight"><pre><code class="javascript"><span class="keyword">var</span> Messenger = FNX.include(<span class="string">'messenger/messenger'</span>);

<span class="comment">// 初始化父页面的信使</span>
<span class="keyword">var</span> messenger = <span class="keyword">new</span> Messenger(<span class="string">'parent'</span>, <span class="string">'MessengerProject'</span>);

<span class="comment">// 绑定子页面 iframe</span>
messenger.addTarget(iframe1.contentWindow, <span class="string">'iframe1'</span>);
messenger.addTarget(iframe2.contentWindow, <span class="string">'iframe2'</span>);

<span class="comment">// 给子页面发消息</span>
messenger.targets[<span class="string">'iframe1'</span>].send(<span class="string">'发给子页面1的消息'</span>);

<span class="comment">// 或者给所有子页面发消息</span>
messenger.send(<span class="string">'发给所有子页面的消息'</span>);</code></pre></div><h1 id="子页面">子页面<a href="#子页面" class="anchor">¶</a></h1><div class="highlight"><pre><code class="javascript"><span class="keyword">var</span> Messenger = FNX.include(<span class="string">'messenger/messenger'</span>);

<span class="comment">// 初始化子页面的信使</span>
<span class="comment">// 注意，第二个参数 `MessengerProject` 必须和父页面的信使保持一致，</span>
<span class="keyword">var</span> messenger = <span class="keyword">new</span> Messenger(<span class="string">'iframe1'</span>, <span class="string">'MessengerProject'</span>);

<span class="comment">// 给父页面发消息</span>
messenger.targets[<span class="string">'parent'</span>].send(<span class="string">'发给父页面的消息'</span>);</code></pre></div><h1 id="示例">示例<a href="#示例" class="anchor">¶</a></h1><p>
    我是父页面
    <script>document.write('(' + location.protocol + '//' + location.host + ')');</script>
</p>

<p>
    <input id="message">
    <input type="button" value="发送给子页面" id="send">
</p>

<pre id="output">来自子页面的消息:</pre>

<div class="nico-iframe">
<iframe src="iframe-messenger-1.html" allowtransparency="true" 
frameborder="0" scrolling="0" ></iframe></div><div class="highlight"><pre><code class="xml"><span class="tag">&lt;<span class="title">p</span>&gt;</span>
  我是子页面
  <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">document.write(<span class="string">'('</span> + location.protocol + <span class="string">'//'</span> + location.host + <span class="string">')'</span>);</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;/<span class="title">p</span>&gt;</span>

<span class="tag">&lt;<span class="title">p</span>&gt;</span>
  <span class="tag">&lt;<span class="title">input</span> <span class="attribute">id</span>=<span class="value">"message"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"button"</span> <span class="attribute">id</span>=<span class="value">"send"</span> <span class="attribute">value</span>=<span class="value">"发送给父页面"</span>&gt;</span>
<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
<span class="tag">&lt;<span class="title">pre</span> <span class="attribute">id</span>=<span class="value">"output"</span>&gt;</span>来自父页面的消息:<span class="tag">&lt;/<span class="title">pre</span>&gt;</span>

<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
<span class="keyword">var</span> Messenger = FNX.include(<span class="string">'messenger/messenger'</span>);

<span class="keyword">var</span> messenger = <span class="keyword">new</span> Messenger(<span class="string">'iframe1'</span>, <span class="string">'demo'</span>);
messenger.addTarget(window.parent, <span class="string">'parent'</span>);

<span class="comment">// 通过点击按钮发送消息</span>
<span class="keyword">var</span> send = $(<span class="string">'#send'</span>);
<span class="keyword">var</span> message = $(<span class="string">'#message'</span>);
<span class="keyword">var</span> output = $(<span class="string">'#output'</span>);
send.click(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    messenger.targets[<span class="string">'parent'</span>].send(message.val());
    <span class="comment">//messenger.send();  // 这样会发给所有 targets</span>
    message.val(<span class="string">''</span>);
});

<span class="comment">// 监听消息</span>
messenger.listen(<span class="function"><span class="keyword">function</span><span class="params">(msg)</span> {</span>
    console.log(<span class="string">'收到'</span>, msg);
    output.html(output.html() + <span class="string">' '</span> + msg);
});

</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

<span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css"><span class="tag">body</span><span class="rules">{<span class="rule"><span class="attribute">background</span>:<span class="value"><span class="hexcolor">#DAF5FF</span></span></span>;<span class="rule"><span class="attribute">padding</span>:<span class="value"><span class="number">15</span>px</span></span>;<span class="rule">}</span></span></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></code></pre></div><p><strong> 父页面这么写</strong></p>
<script>var Messenger = FNX.include('messenger/messenger');

var messenger = new Messenger('parent', 'demo');
messenger.addTarget($('iframe')[0].contentWindow, 'iframe1');

// 通过点击按钮发送消息
var send = $('#send');
var message = $('#message');
var output = $('#output');
send.click(function() {
    console.log('发出', message.val());
    messenger.targets['iframe1'].send(message.val());
    message.val('');
});

// 监听消息
messenger.listen(function(msg) {
    output.html(output.html() + ' ' + msg);
});</script><div class="highlight"><pre><code class="javascript"><span class="keyword">var</span> Messenger = FNX.include(<span class="string">'messenger/messenger'</span>);

<span class="keyword">var</span> messenger = <span class="keyword">new</span> Messenger(<span class="string">'parent'</span>, <span class="string">'demo'</span>);
messenger.addTarget($(<span class="string">'iframe'</span>)[<span class="number">0</span>].contentWindow, <span class="string">'iframe1'</span>);

<span class="comment">// 通过点击按钮发送消息</span>
<span class="keyword">var</span> send = $(<span class="string">'#send'</span>);
<span class="keyword">var</span> message = $(<span class="string">'#message'</span>);
<span class="keyword">var</span> output = $(<span class="string">'#output'</span>);
send.click(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    console.log(<span class="string">'发出'</span>, message.val());
    messenger.targets[<span class="string">'iframe1'</span>].send(message.val());
    message.val(<span class="string">''</span>);
});

<span class="comment">// 监听消息</span>
messenger.listen(<span class="function"><span class="keyword">function</span><span class="params">(msg)</span> {</span>
    output.html(output.html() + <span class="string">' '</span> + msg);
});</code></pre></div>

			</div>
		</div>
	</div>
</div>





<footer class="doc-footer">
	<a href="../../">飞牛武汉UED</a><br>愿景: 成为业界卓越的UED团队！
</footer>

<script type="text/javascript" src="../../static/js/site.js"></script>


</body>

</html>